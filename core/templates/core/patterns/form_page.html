{% comment %}
Pattern: Form Page
Purpose: Standardized layout for create/edit forms with SAP Fiori styling
Requirements: 3.1, 3.2, 4.3, 4.5, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7

Features:
- Compact form section headers (text-sm font-semibold)
- Reduced spacing between form rows (mb-2)
- Updated button components for actions
- Form validation display with alerts
- Uses reusable form components
- Responsive layout with proper padding

Usage:
{% extends 'core/patterns/form_page.html' %}

{% block form_title %}Create Customer{% endblock %}
{% block form_header %}Create Customer{% endblock %}
{% block back_url %}{% url 'customers:list' %}{% endblock %}
{% block cancel_url %}{% url 'customers:list' %}{% endblock %}

{% block form_sections %}
  {# Use form_section component for grouping #}
  <div class="bg-white border border-gray-200 rounded mb-4">
    <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
      <h3 class="text-sm font-semibold text-gray-700">Basic Information</h3>
    </div>
    <div class="p-4">
      {# Use mb-2 spacing between form rows #}
      <div class="mb-2">
        {% include 'core/components/forms/text_input.html' with label="Name" name="name" value=form.name.value required=True %}
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-2">
        {% include 'core/components/forms/text_input.html' with label="Email" name="email" value=form.email.value %}
        {% include 'core/components/forms/text_input.html' with label="Phone" name="phone" value=form.phone.value %}
      </div>
    </div>
  </div>
{% endblock %}
{% endcomment %}

{% extends 'core/base.html' %}

{% block title %}{% block form_title %}Form{% endblock %} - Cortex ERP{% endblock %}
{% block page_title %}{% block form_header %}Form{% endblock %}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-4">
    {# Back Link #}
    {% block back_link %}
    <div class="mb-3">
        <a href="{% block back_url %}#{% endblock %}" 
           class="inline-flex items-center gap-1 text-xs text-sap-blue hover:text-sap-blue-hover transition-colors">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to List
        </a>
    </div>
    {% endblock %}

    {# Form Validation Messages #}
    {% block form_messages %}
    {% if messages %}
        {% for message in messages %}
            {% include 'core/components/feedback/alert.html' with
                type=message.tags
                message=message
                dismissible=True
            %}
        {% endfor %}
    {% endif %}
    
    {# Django Form Errors (Non-field errors) #}
    {% if form.non_field_errors %}
        {% include 'core/components/feedback/alert.html' with
            type='error'
            title='Form Validation Error'
            message=form.non_field_errors|join:', '
        %}
    {% endif %}
    
    {# General form errors summary #}
    {% if form.errors %}
        {% include 'core/components/feedback/alert.html' with
            type='error'
            title='Please correct the errors below'
            message='Some fields contain invalid data. Please review and correct them.'
        %}
    {% endif %}
    {% endblock %}

    <form method="post" {% if multipart %}enctype="multipart/form-data"{% endif %} id="main-form" {% block form_attrs %}{% endblock %}>
        {% csrf_token %}
        
        {% block form_content %}
        {# Main Form Content #}
        <div class="bg-white border border-gray-200 shadow-sm rounded">
            {% block form_sections %}
            {# Form sections go here - Use compact section headers #}
            <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                <h3 class="text-sm font-semibold text-gray-700">{% block section_title %}Form Section{% endblock %}</h3>
                {% block section_subtitle %}{% endblock %}
            </div>
            <div class="p-4">
                {% block form_fields %}
                {# Form fields go here - Use mb-2 spacing between rows #}
                {# Example single field: #}
                {# <div class="mb-2"> #}
                {#   {% include 'core/components/forms/text_input.html' with label="Field Name" name="field_name" %} #}
                {# </div> #}
                
                {# Example two-column grid: #}
                {# <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-2"> #}
                {#   {% include 'core/components/forms/text_input.html' with label="First Name" name="first_name" %} #}
                {#   {% include 'core/components/forms/text_input.html' with label="Last Name" name="last_name" %} #}
                {# </div> #}
                {% endblock %}
            </div>
            {% endblock %}
            
            {# Form Actions - Using button components #}
            <div class="border-t border-gray-200 px-4 py-3 bg-gray-50 flex items-center justify-end gap-2">
                {% block form_actions %}
                {# Cancel Button - Using secondary button component #}
                {% include 'core/components/buttons/secondary.html' with
                    text='Cancel'
                    icon='x'
                    url=cancel_url
                %}
                
                {# Submit Button - Using primary button component #}
                {% include 'core/components/buttons/primary.html' with
                    text=submit_text|default:'Save'
                    icon='check'
                    type='submit'
                %}
                {% endblock %}
            </div>
        </div>
        {% endblock %}
    </form>
</div>

{% block form_scripts %}
{# Additional JavaScript for form #}
{# HTMX re-initialization after dynamic updates #}
<script>
document.body.addEventListener('htmx:afterSwap', function(event) {
    // Re-initialize any form components that need it
    // (e.g., date pickers, select2, etc.)
    if (typeof initializeDatePickers === 'function') {
        initializeDatePickers();
    }
    if (typeof initializeSelect2 === 'function') {
        initializeSelect2();
    }
});
</script>
{% endblock %}
{% endblock %}








