{# Search Bar with Filters Component #}
{# Usage: {% include 'core/components/search_bar_with_filters.html' with placeholder="..." %} #}
{#
    Parameters:
    - placeholder: Placeholder text for search input (default: "Search...")
    - htmx_enabled: Enable HTMX for live search (default: False)
    - search_url: URL for HTMX search endpoint (required if htmx_enabled=True)
    - target: HTMX target selector (default: "#results")
    - filters: List of filter definitions (optional)
        [
            {
                'name': 'role',
                'label': 'All Roles',
                'options': [
                    {'value': 'admin', 'label': 'Admin'},
                    {'value': 'user', 'label': 'User'}
                ]
            }
        ]
    - clear_url: URL for clear filters link (default: current path)
#}

<div class="bg-white rounded border border-gray-200 p-4 mb-4">
    <form method="get" class="flex items-center gap-4" {% if htmx_enabled %}id="search-form"{% endif %}>
        <!-- Search Input -->
        <div class="flex-1 relative">
            <input type="text"
                   name="search"
                   value="{{ request.GET.search }}"
                   placeholder="{{ placeholder|default:'Search...' }}"
                   {% if htmx_enabled %}
                   hx-get="{{ search_url }}"
                   hx-trigger="keyup changed delay:500ms"
                   hx-target="{{ target|default:'#results' }}"
                   hx-indicator="#search-spinner"
                   hx-include="[name]:not([name='page'])"
                   {% endif %}
                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sap-blue focus:border-transparent">

            {% if htmx_enabled %}
            <span id="search-spinner" class="htmx-indicator absolute right-3 top-1/2 transform -translate-y-1/2">
                <svg class="animate-spin h-5 w-5 text-sap-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </span>
            {% endif %}
        </div>

        <!-- Additional Filters -->
        {% if filters %}
            {% for filter in filters %}
            <select name="{{ filter.name }}"
                    {% if htmx_enabled %}
                    hx-get="{{ search_url }}"
                    hx-trigger="change"
                    hx-target="{{ target|default:'#results' }}"
                    hx-include="[name]:not([name='page'])"
                    {% endif %}
                    class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sap-blue">
                <option value="">{{ filter.label }}</option>
                {% for option in filter.options %}
                <option value="{{ option.value }}"
                        {% if request.GET|get_item:filter.name == option.value|stringformat:"s" %}selected{% endif %}>
                    {{ option.label }}
                </option>
                {% endfor %}
            </select>
            {% endfor %}
        {% endif %}

        <!-- Submit Button (only if HTMX is disabled) -->
        {% if not htmx_enabled %}
        <button type="submit"
                class="bg-sap-blue hover:bg-sap-blue-dark text-white px-6 py-2 rounded-md transition-colors">
            Filter
        </button>
        {% endif %}

        <!-- Clear Filters Button -->
        {% if request.GET.search or request.GET.items %}
        <a href="{{ clear_url|default:request.path }}"
           class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-md transition-colors">
            Clear
        </a>
        {% endif %}
    </form>
</div>

<style>
.htmx-indicator {
    display: none;
}
.htmx-request .htmx-indicator {
    display: inline-block;
}
</style>








