{% extends 'core/base.html' %}
{% load static %}

{% block title %}Salary Slip - {{ employee.employeename }} - Cortex ERP{% endblock %}

{% block content %}
<div class="max-w-full mx-auto px-4 py-2">
    <div class="bg-white rounded border border-gray-200">
        <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-semibold text-gray-800">Salary Slip - {{ month_name }}</h1>
            <div class="flex space-x-2">
                <a href="{% url 'human_resource:salary-edit' salary.id %}" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition text-sm">
                    Edit
                </a>
                <a href="{% url 'human_resource:salary-list' %}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition text-sm">
                    Back to List
                </a>
            </div>
        </div>

        <!-- Employee Info -->
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            {% if employee %}
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">Emp ID</label>
                    <p class="mt-1 text-sm font-semibold text-gray-900">{{ employee.empid }}</p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">Name</label>
                    <p class="mt-1 text-sm font-semibold text-gray-900">{{ employee.title }} {{ employee.employeename }}</p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">Department</label>
                    <p class="mt-1 text-sm text-gray-900">{{ department_name.description|default:"-" }}</p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">Designation</label>
                    <p class="mt-1 text-sm text-gray-900">{{ designation_name.type|default:"-" }}</p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">Account No</label>
                    <p class="mt-1 text-sm text-gray-900">{{ employee.bankaccountno|default:"-" }}</p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">PF No</label>
                    <p class="mt-1 text-sm text-gray-900">{{ employee.pfno|default:"-" }}</p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">PAN No</label>
                    <p class="mt-1 text-sm text-gray-900">{{ employee.panno|default:"-" }}</p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 uppercase">Status</label>
                    <p class="mt-1">
                        {% if salary.releaseflag %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Released</span>
                        {% else %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Attendance Details -->
        {% if salary_detail %}
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Attendance Summary</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
                <div class="text-center">
                    <div class="text-sm font-bold text-green-600">{{ salary_detail.present|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">Present</div>
                </div>
                <div class="text-center">
                    <div class="text-sm font-bold text-red-600">{{ salary_detail.absent|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">Absent</div>
                </div>
                <div class="text-center">
                    <div class="text-sm font-bold text-yellow-600">{{ salary_detail.latein|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">Late In</div>
                </div>
                <div class="text-center">
                    <div class="text-sm font-bold text-orange-600">{{ salary_detail.halfday|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">Half Day</div>
                </div>
                <div class="text-center">
                    <div class="text-sm font-bold text-blue-600">{{ salary_detail.sunday|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">Sunday</div>
                </div>
                <div class="text-center">
                    <div class="text-sm font-bold text-purple-600">{{ salary_detail.coff|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">C-Off</div>
                </div>
                <div class="text-center">
                    <div class="text-sm font-bold text-indigo-600">{{ salary_detail.pl|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">PL</div>
                </div>
                <div class="text-center">
                    <div class="text-sm font-bold text-pink-600">{{ salary_detail.overtimehrs|floatformat:1 }}</div>
                    <div class="text-xs text-gray-500 uppercase">OT Hours</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Salary Breakdown -->
        {% if salary_components %}
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Salary Breakdown</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Particulars</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Qty</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Amount</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for component in salary_components %}
                        <tr>
                            <td class="px-4 py-2 text-sm text-gray-900">{{ component.perticulars }}</td>
                            <td class="px-4 py-2 text-sm text-right">{{ component.qty|default:"0" }}</td>
                            <td class="px-4 py-2 text-sm text-right">{{ component.amount|floatformat:2|default:"0.00" }}</td>
                            <td class="px-4 py-2 text-sm text-right font-medium">
                                {% widthratio component.qty 1 component.amount as total %}
                                {{ total|floatformat:2 }}
                            </td>
                            <td class="px-4 py-2 text-sm">
                                {% if component.includesin == 1 %}
                                <span class="px-2 py-1 text-xs rounded bg-green-100 text-green-800">Gross</span>
                                {% elif component.includesin == 2 %}
                                <span class="px-2 py-1 text-xs rounded bg-blue-100 text-blue-800">CTC</span>
                                {% elif component.includesin == 3 %}
                                <span class="px-2 py-1 text-xs rounded bg-purple-100 text-purple-800">Net</span>
                                {% else %}-{% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Final Calculation -->
        {% if salary_detail %}
        <div class="px-6 py-4">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Salary Calculation</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-green-50 rounded p-4 border border-green-200">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Additions</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span>Overtime:</span>
                            <span class="font-semibold">{{ overtime_amount|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Other Addition:</span>
                            <span class="font-semibold">{{ salary_detail.addition|floatformat:2 }}</span>
                        </div>
                        {% if salary_detail.remarks1 %}
                        <p class="text-xs text-gray-600 mt-2">{{ salary_detail.remarks1 }}</p>
                        {% endif %}
                    </div>
                </div>

                <div class="bg-red-50 rounded p-4 border border-red-200">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Deductions</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span>Installment:</span>
                            <span class="font-semibold">{{ salary_detail.installment|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Mobile Excess:</span>
                            <span class="font-semibold">{{ salary_detail.mobileexeamt|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Other Deduction:</span>
                            <span class="font-semibold">{{ salary_detail.deduction|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between border-t pt-1 mt-1">
                            <span class="font-medium">Total:</span>
                            <span class="font-bold">{{ total_deductions|floatformat:2 }}</span>
                        </div>
                        {% if salary_detail.remarks2 %}
                        <p class="text-xs text-gray-600 mt-2">{{ salary_detail.remarks2 }}</p>
                        {% endif %}
                    </div>
                </div>

                <div class="bg-blue-50 rounded p-4 border border-blue-200">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Net Salary</h3>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span>Base Net:</span>
                            <span class="font-semibold">{{ net_total|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between text-green-600">
                            <span>+ Additions:</span>
                            <span class="font-semibold">{{ overtime_amount|add:salary_detail.addition|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between text-red-600">
                            <span>- Deductions:</span>
                            <span class="font-semibold">{{ total_deductions|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between border-t-2 border-blue-300 pt-2 mt-2">
                            <span class="text-lg font-bold">Net Payable:</span>
                            <span class="text-lg font-bold text-blue-600">{{ net_salary|floatformat:2 }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}








