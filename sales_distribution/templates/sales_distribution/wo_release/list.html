{% extends 'core/base.html' %}
{% load static %}

{% block title %}Work Order Release{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-2xl font-semibold text-gray-900">Work Order Release</h1>
        <p class="mt-1 text-sm text-gray-600">Select a work order to process release</p>
    </div>

    <!-- Search Bar -->
    <div class="mb-4">
        <form method="get" class="flex items-center gap-3">
            <!-- Search Field Dropdown -->
            <select name="search_field"
                    class="h-10 px-3 text-sm border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                {% for value, label in search_fields %}
                <option value="{{ value }}" {% if search_field == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>

            <!-- Search Input -->
            <div class="relative flex-1">
                <input type="text"
                       name="search"
                       value="{{ search }}"
                       placeholder="Search..."
                       class="h-10 w-full pl-10 pr-3 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>

            <!-- Search Button -->
            <button type="submit" class="h-10 px-4 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Search
            </button>

            <!-- Clear Button -->
            {% if search %}
            <a href="{% url 'sales_distribution:wo-release-list' %}" class="h-10 px-4 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 inline-flex items-center">
                Clear
            </a>
            {% endif %}
        </form>
    </div>

    <!-- Results Info -->
    <div class="mb-2 text-sm text-gray-600">
        {% if work_orders %}
        Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ page_obj.paginator.count }} work order(s)
        {% else %}
        No work orders found
        {% endif %}
    </div>

    <!-- Work Order Table (SAP Fiori Style) -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-gray-50 border-b border-gray-200 h-10">
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200 w-12">SN</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200 w-24">Fin Yrs</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200">Customer Name</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200 w-28">Code</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200 w-32">Enquiry No</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200 w-32">PO No</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200 w-32">WO No</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 border-r border-gray-200 w-28">Gen. Date</th>
                    <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 w-28">Gen. By</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for wo in work_orders %}
                <tr class="border-b hover:bg-blue-50/30 transition-colors cursor-pointer h-10" onclick="window.location.href='{% url 'sales_distribution:wo-release-detail' wo.id %}'">
                    <td class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100">{{ forloop.counter }}</td>
                    <td class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100">{{ wo.finyear_name|default:'-' }}</td>
                    <td class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100">{{ wo.customer_name|default:'-' }}</td>
                    <td class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100">{{ wo.customerid|default:'-' }}</td>
                    <td class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100">{{ wo.enqid|default:'-' }}</td>
                    <td class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100">{{ wo.pono|default:'-' }}</td>
                    <td class="px-3 py-2 text-xs text-blue-600 font-medium border-r border-gray-100 hover:underline">
                        <a href="{% url 'sales_distribution:wo-release-detail' wo.id %}">{{ wo.wono|default:'-' }}</a>
                    </td>
                    <td class="px-3 py-2 text-xs text-gray-900 border-r border-gray-100">{{ wo.sysdate|default:'-' }}</td>
                    <td class="px-3 py-2 text-xs text-gray-900">{{ wo.generated_by|default:'-' }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="9" class="px-3 py-8 text-center text-sm text-gray-500">
                        No work orders found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="mt-4 flex items-center justify-between">
        <div class="text-sm text-gray-600">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </div>
        <div class="flex gap-2">
            {% if page_obj.has_previous %}
            <a href="?page=1{% if search %}&search={{ search }}&search_field={{ search_field }}{% endif %}"
               class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50">First</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}&search_field={{ search_field }}{% endif %}"
               class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50">Previous</a>
            {% endif %}

            <span class="px-3 py-1 text-sm bg-blue-600 text-white rounded">{{ page_obj.number }}</span>

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}&search_field={{ search_field }}{% endif %}"
               class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}&search_field={{ search_field }}{% endif %}"
               class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50">Last</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
