{% extends "core/base.html" %}

{% block title %}New Customer PO - Select Enquiry - Cortex ERP{% endblock %}
{% block page_title %}New Customer PO{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header matching ASP.NET -->
    <div class="bg-gradient-to-b from-gray-600 to-gray-800 rounded-t-lg px-3 py-2 mb-0">
        <h2 class="text-sm font-bold text-white">Customer PO - New</h2>
    </div>

    <!-- Search Section matching ASP.NET -->
    <div class="bg-white border border-gray-300 p-4 mb-0">
        <div class="flex items-center gap-3">
            <!-- Dropdown for search type (matching ASP.NET) -->
            <select id="search-type" class="px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="select">Select</option>
                <option value="customer">Customer Name</option>
                <option value="enquiry">Enquiry No</option>
            </select>

            <!-- Search input (matching ASP.NET functionality) -->
            <input type="text" name="search_value" id="search_value"
                placeholder="Enter search value..."
                hx-get="{% url 'sales_distribution:po-search-results' %}"
                hx-trigger="input changed delay:500ms, search"
                hx-target="#enquiry-results"
                hx-include="[name='search_value'], #search-type"
                hx-indicator="#search-indicator"
                class="px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                class="w-[350px]" />

            <!-- Search button (matching ASP.NET) -->
            <button type="button"
                    hx-get="{% url 'sales_distribution:po-search-results' %}"
                    hx-target="#enquiry-results"
                    hx-include="[name='search_value'], #search-type"
                    class="bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-1.5 rounded-md text-sm transition-colors">
                Search
            </button>

            <div id="search-indicator" class="htmx-indicator">
                <svg class="animate-spin h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Results Table (matching ASP.NET GridView exactly) -->
    <div id="enquiry-results" class="bg-white border border-gray-300 overflow-hidden">
        <table class="w-full text-xs border-collapse">
            <thead>
                <tr class="bg-gray-50 border-b border-gray-300">
                    <th class="px-3 py-2 text-xs font-semibold text-gray-700 text-right border-r border-gray-300" class="w-[5%]">SN</th>
                    <th class="px-3 py-2 text-xs font-semibold text-gray-700 text-center border-r border-gray-300" class="w-[8%]">Fin Yrs</th>
                    <th class="px-3 py-2 text-xs font-semibold text-gray-700 text-left border-r border-gray-300" class="w-[35%]">Customer Name</th>
                    <th class="px-3 py-2 text-xs font-semibold text-gray-700 text-center border-r border-gray-300" class="w-[10%]">Code</th>
                    <th class="px-3 py-2 text-xs font-semibold text-gray-700 text-center border-r border-gray-300" class="w-[12%]">Enquiry No</th>
                    <th class="px-3 py-2 text-xs font-semibold text-gray-700 text-center border-r border-gray-300" class="w-[10%]">Gen Date</th>
                    <th class="px-3 py-2 text-xs font-semibold text-gray-700 text-left w-[20%]">Gen By</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for enquiry in enquiries %}
                <tr class="hover:bg-gray-50 border-b border-gray-200">
                    <td class="px-3 py-2 text-xs text-gray-900 text-right border-r border-gray-200">{{ forloop.counter }}</td>
                    <td class="px-3 py-2 text-xs text-gray-700 text-center border-r border-gray-200">{{ enquiry.finyear_name }}</td>
                    <td class="px-3 py-2 text-xs text-gray-900 text-left border-r border-gray-200">{{ enquiry.customername }}</td>
                    <td class="px-3 py-2 text-xs text-gray-700 text-center border-r border-gray-200">{{ enquiry.customerid }}</td>
                    <td class="px-3 py-2 text-xs text-center border-r border-gray-200">
                        {# Enquiry No as hyperlink (matching ASP.NET HyperLinkField) #}
                        <a href="{% url 'sales_distribution:po-create-detail' enquiry.enqid %}"
                           class="text-blue-600 hover:text-blue-800 hover:underline font-medium">
                            {{ enquiry.enqid }}
                        </a>
                    </td>
                    <td class="px-3 py-2 text-xs text-gray-700 text-center border-r border-gray-200">{{ enquiry.sysdate }}</td>
                    <td class="px-3 py-2 text-xs text-gray-700 text-left">{{ enquiry.generated_by }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="px-6 py-16 text-center border-b border-gray-200">
                        <span class="text-red-700 font-bold text-base">No data to display !</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Back button -->
    <div class="mt-4 text-right">
        <a href="{% url 'sales_distribution:po-list' %}"
           class="inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium px-6 py-2 rounded-md text-sm transition-colors">
            Back to PO List
        </a>
    </div>
</div>

<style>
    .htmx-indicator {
        display: none;
    }
    .htmx-request .htmx-indicator {
        display: inline-block;
    }
</style>
{% endblock %}










