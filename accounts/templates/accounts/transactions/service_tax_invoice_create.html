{% extends "core/base.html" %}
{% load static %}

{% block title %}Create Service Tax Invoice{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">Create Service Tax Invoice</h1>
        <a href="{% url 'accounts:service-tax-invoice-list' %}"
           class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
            Back to List
        </a>
    </div>

    <form method="post" class="bg-white rounded-lg shadow p-6">
        {% csrf_token %}

        <!-- PO/WO Selection -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">PO Number</label>
                <select name="poid" id="id_poid" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">Select PO</option>
                    {% for po in pos %}
                    <option value="{{ po.poid }}">{{ po.pono }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">PO No (Text)</label>
                <input type="text" name="pono" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">WO Number</label>
                <input type="text" name="wono" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Date of Issue</label>
                <input type="text" name="dateofissueinvoice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="DD-MM-YYYY">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Customer Code</label>
                <input type="text" name="customercode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <!-- Buyer Details -->
        <h3 class="text-lg font-semibold text-gray-700 mb-4 mt-6 border-b pb-2">Buyer Details</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Buyer Name *</label>
                <input type="text" name="buyer_name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Buyer Address</label>
                <input type="text" name="buyer_add" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                <select name="buyer_country" id="id_buyer_country" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">Select Country</option>
                    {% for country in countries %}
                    <option value="{{ country.countryid }}">{{ country.country }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                <input type="text" name="buyer_ph" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" name="buyer_email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">TIN</label>
                <input type="text" name="buyer_tin" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <!-- Consignee Details -->
        <h3 class="text-lg font-semibold text-gray-700 mb-4 mt-6 border-b pb-2">Consignee Details</h3>
        <div class="mb-4">
            <button type="button" id="copyBuyerBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                Copy from Buyer
            </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Consignee Name</label>
                <input type="text" name="cong_name" id="id_cong_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Consignee Address</label>
                <input type="text" name="cong_add" id="id_cong_add" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                <input type="text" name="cong_ph" id="id_cong_ph" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" name="cong_email" id="id_cong_email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <!-- Tax Details -->
        <h3 class="text-lg font-semibold text-gray-700 mb-4 mt-6 border-b pb-2">Tax Details</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Service Tax %</label>
                <input type="number" step="0.01" name="servicetax" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Addition Amount</label>
                <input type="number" step="0.01" name="addamt" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Deduction Amount</label>
                <input type="number" step="0.01" name="deduction" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <!-- Items Section (Simplified) -->
        <h3 class="text-lg font-semibold text-gray-700 mb-4 mt-6 border-b pb-2">Invoice Items</h3>
        <div id="items-container">
            <div class="grid grid-cols-5 gap-2 mb-2">
                <input type="number" name="item_id[]" placeholder="Item ID" class="px-3 py-2 border border-gray-300 rounded-lg">
                <input type="number" step="0.01" name="qty[]" placeholder="Quantity" class="px-3 py-2 border border-gray-300 rounded-lg">
                <input type="number" step="0.01" name="rate[]" placeholder="Rate" class="px-3 py-2 border border-gray-300 rounded-lg">
                <input type="number" name="unit[]" placeholder="Unit ID" class="px-3 py-2 border border-gray-300 rounded-lg">
                <button type="button" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">Remove</button>
            </div>
        </div>
        <button type="button" id="addItemBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm mt-2">
            Add Item
        </button>

        <!-- Submit Buttons -->
        <div class="flex justify-end gap-4 mt-8 pt-6 border-t">
            <a href="{% url 'accounts:service-tax-invoice-list' %}"
               class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
                Cancel
            </a>
            <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                Create Invoice
            </button>
        </div>
    </form>
</div>

<script>
document.getElementById('copyBuyerBtn').addEventListener('click', function() {
    document.getElementById('id_cong_name').value = document.querySelector('[name="buyer_name"]').value;
    document.getElementById('id_cong_add').value = document.querySelector('[name="buyer_add"]').value;
    document.getElementById('id_cong_ph').value = document.querySelector('[name="buyer_ph"]').value;
    document.getElementById('id_cong_email').value = document.querySelector('[name="buyer_email"]').value;
});

document.getElementById('addItemBtn').addEventListener('click', function() {
    const container = document.getElementById('items-container');
    const newRow = container.children[0].cloneNode(true);
    newRow.querySelectorAll('input').forEach(input => input.value = '');
    container.appendChild(newRow);
});
</script>
{% endblock %}
