{% extends 'core/patterns/detail_page.html' %}
{% load static %}

{% block title %}Invoice {{ invoice.invoice_no }} - Cortex ERP{% endblock %}
{% block page_title %}Invoice {{ invoice.invoice_no }}{% endblock %}
{% block page_subtitle %}{{ invoice.invoice_date|date:"d/m/Y" }}{% endblock %}

{% block breadcrumbs %}
    {% include 'core/components/layout/breadcrumb.html' with 
        items=breadcrumb_items
    %}
{% endblock %}

{% block actions %}
    <div class="flex gap-2">
        {% include 'core/components/buttons/secondary.html' with 
            text="Back to List"
            icon="arrow-left"
            url="accounts:invoices:invoice-list"
            size="compact"
        %}
        {% include 'core/components/buttons/primary.html' with 
            text="Edit"
            icon="edit"
            url="accounts:invoices:invoice-update"
            url_args=invoice.pk
            size="compact"
        %}
        {% include 'core/components/buttons/success.html' with 
            text="Print"
            icon="print"
            url="accounts:invoices:invoice-print"
            url_args=invoice.pk
            target="_blank"
            size="compact"
        %}
    </div>
{% endblock %}

{% block detail_content %}
    <!-- Invoice Info Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div class="bg-white rounded border border-gray-200 p-4">
            {% include 'core/components/cards/card_header.html' with 
                title="Buyer Information"
            %}
            <dl class="space-y-1 text-xs mt-3">
                <div class="flex"><dt class="font-medium text-gray-600 w-24">Name:</dt><dd>{{ invoice.buyer_name }}</dd></div>
                <div class="flex"><dt class="font-medium text-gray-600 w-24">Address:</dt><dd>{{ invoice.buyer_address }}</dd></div>
                <div class="flex"><dt class="font-medium text-gray-600 w-24">City:</dt><dd>{{ invoice.buyer_city }}, {{ invoice.buyer_state }}</dd></div>
                <div class="flex"><dt class="font-medium text-gray-600 w-24">GST:</dt><dd>{{ invoice.buyer_gst_no|default:"-" }}</dd></div>
            </dl>
        </div>
        
        <div class="bg-white rounded border border-gray-200 p-4">
            {% include 'core/components/cards/card_header.html' with 
                title="Consignee Information"
            %}
            <dl class="space-y-1 text-xs mt-3">
                <div class="flex"><dt class="font-medium text-gray-600 w-24">Name:</dt><dd>{{ invoice.consignee_name }}</dd></div>
                <div class="flex"><dt class="font-medium text-gray-600 w-24">Address:</dt><dd>{{ invoice.consignee_address }}</dd></div>
                <div class="flex"><dt class="font-medium text-gray-600 w-24">City:</dt><dd>{{ invoice.consignee_city }}, {{ invoice.consignee_state }}</dd></div>
                <div class="flex"><dt class="font-medium text-gray-600 w-24">GST:</dt><dd>{{ invoice.consignee_gst_no|default:"-" }}</dd></div>
            </dl>
        </div>
    </div>

    <!-- Line Items -->
    <div class="bg-white rounded border border-gray-200 overflow-hidden mb-4">
        {% include 'core/components/cards/card_header.html' with 
            title="Line Items"
        %}
        <div class="overflow-x-auto">
            {% include 'core/components/tables/data_table.html' with 
                headers=line_item_headers
                compact=True
            %}
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr class="h-8">
                        <th class="px-3 py-1 text-left text-xs font-semibold text-gray-700">Sr</th>
                        <th class="px-3 py-1 text-left text-xs font-semibold text-gray-700">Description</th>
                        <th class="px-3 py-1 text-right text-xs font-semibold text-gray-700">Qty</th>
                        <th class="px-3 py-1 text-right text-xs font-semibold text-gray-700">Rate</th>
                        <th class="px-3 py-1 text-right text-xs font-semibold text-gray-700">Amount</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-100">
                    {% for item in line_items %}
                    <tr class="h-8 hover:bg-gray-50">
                        <td class="px-3 py-1 text-xs">{{ item.srno }}</td>
                        <td class="px-3 py-1 text-xs">{{ item.itemdescription }}</td>
                        <td class="px-3 py-1 text-xs text-right">{{ item.reqqty|floatformat:3 }}</td>
                        <td class="px-3 py-1 text-xs text-right">₹{{ item.rate|floatformat:2 }}</td>
                        <td class="px-3 py-1 text-xs text-right font-medium">₹{{ item.amount|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Totals -->
    <div class="bg-white rounded border border-gray-200 p-4">
        {% include 'core/components/cards/card_header.html' with 
            title="Invoice Summary"
        %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
            <div class="space-y-1 text-xs">
                <div class="flex justify-between"><span class="text-gray-600">Subtotal:</span><span class="font-medium">₹{{ invoice.subtotal|floatformat:2 }}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">Freight:</span><span class="font-medium">₹{{ invoice.freight_charges|floatformat:2 }}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">Packing:</span><span class="font-medium">₹{{ invoice.packing_charges|floatformat:2 }}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">Discount:</span><span class="font-medium text-sap-red">-₹{{ invoice.discount_amount|floatformat:2 }}</span></div>
            </div>
            <div class="space-y-1 text-xs">
                <div class="flex justify-between"><span class="text-gray-600">CGST:</span><span class="font-medium">₹{{ invoice.cgst_amount|floatformat:2 }}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">SGST:</span><span class="font-medium">₹{{ invoice.sgst_amount|floatformat:2 }}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">IGST:</span><span class="font-medium">₹{{ invoice.igst_amount|floatformat:2 }}</span></div>
                <div class="flex justify-between text-sm font-bold border-t border-gray-200 pt-1 mt-1">
                    <span class="text-gray-900">Grand Total:</span>
                    <span class="text-sap-blue">₹{{ invoice.grand_total|floatformat:2 }}</span>
                </div>
            </div>
        </div>
    </div>
{% endblock %}








