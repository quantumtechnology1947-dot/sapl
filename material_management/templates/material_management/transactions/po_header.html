{% extends 'core/base.html' %}
{% load static %}

{% block title %}PO - Final Creation - Cortex ERP{% endblock %}

{% block content %}
<div class="max-w-full mx-auto px-2 py-2">
    {% if messages %}
    <div class="mb-2">
        {% for message in messages %}
        <div class="bg-{{ message.tags }}-100 border border-{{ message.tags }}-400 text-{{ message.tags }}-700 px-2 py-1 rounded text-xs mb-1" role="alert">
            <span class="block sm:inline">{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="bg-white rounded shadow">
        <div class="bg-gradient-to-r from-gray-700 to-gray-800 px-3 py-2 rounded-t flex justify-between items-center">
            <h1 class="text-white font-semibold text-sm">&nbsp;PO - Final Creation</h1>
            <a href="{% if pr_spr_flag == 1 %}{% url 'material_management:po-spr-items' supplier.supplier_id %}{% else %}{% url 'material_management:po-pr-items' supplier.supplier_id %}{% endif %}"
               class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition">
                Back to Items
            </a>
        </div>

        <form method="post" enctype="multipart/form-data" class="p-4">
            {% csrf_token %}

            <!-- Supplier Info (Read-Only) -->
            <div class="mb-6 p-3 bg-gray-50 rounded border border-gray-200">
                <h3 class="text-xs font-semibold text-gray-700 mb-2">Supplier Information</h3>
                <div class="grid grid-cols-3 gap-4 text-[11px]">
                    <div>
                        <span class="font-medium text-gray-700">Supplier:</span>
                        <span class="text-gray-900">{{ supplier.supplier_name }}</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700">Code:</span>
                        <span class="text-gray-900">{{ supplier.supplier_id }}</span>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700">Type:</span>
                        <span class="text-gray-900">{% if pr_spr_flag == 1 %}SPR{% else %}PR{% endif %}</span>
                    </div>
                </div>
            </div>

            <!-- Selected Items Table -->
            <div class="mb-6">
                <h3 class="text-xs font-semibold text-gray-700 mb-2">Selected Items ({{ temp_items.count }})</h3>
                <div class="overflow-x-auto border border-gray-200 rounded">
                    <table class="w-full table-fixed divide-y divide-gray-200 text-xs">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="w-[5%] px-2 py-2 text-right text-[10px] font-medium text-gray-500 uppercase">SN</th>
                                <th class="w-[10%] px-2 py-2 text-center text-[10px] font-medium text-gray-500 uppercase">Item Code</th>
                                <th class="w-[25%] px-2 py-2 text-left text-[10px] font-medium text-gray-500 uppercase">Description</th>
                                <th class="w-[8%] px-2 py-2 text-right text-[10px] font-medium text-gray-500 uppercase">Qty</th>
                                <th class="w-[8%] px-2 py-2 text-right text-[10px] font-medium text-gray-500 uppercase">Rate</th>
                                <th class="w-[8%] px-2 py-2 text-right text-[10px] font-medium text-gray-500 uppercase">Discount%</th>
                                <th class="w-[10%] px-2 py-2 text-right text-[10px] font-medium text-gray-500 uppercase">Total Amt</th>
                                <th class="w-[10%] px-2 py-2 text-center text-[10px] font-medium text-gray-500 uppercase">Del. Date</th>
                                <th class="w-[16%] px-2 py-2 text-left text-[10px] font-medium text-gray-500 uppercase">Remarks</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for item in temp_items %}
                            <tr>
                                <td class="px-2 py-2 text-[11px] text-gray-900 text-right">{{ forloop.counter }}</td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 text-center">{{ item.item.itemcode }}</td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 truncate" title="{{ item.item.purchasedesc }}">
                                    {{ item.item.purchasedesc }}
                                </td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 text-right">{{ item.qty }}</td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 text-right">{{ item.rate }}</td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 text-right">{{ item.discount }}%</td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 text-right font-medium">{{ item.totalamt|floatformat:2 }}</td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 text-center">{{ item.deldate|default:"-" }}</td>
                                <td class="px-2 py-2 text-[11px] text-gray-900 truncate" title="{{ item.remarks }}">
                                    {{ item.remarks|default:"-" }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- PO Header Fields -->
            <div class="mb-6">
                <h3 class="text-xs font-semibold text-gray-700 mb-3">Purchase Order Details</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Reference</label>
                        <input type="text" name="reference"
                               class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>

                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Reference Date</label>
                        <input type="date" name="reference_date"
                               class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>

                    <div class="col-span-2">
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Reference Description</label>
                        <textarea name="reference_desc" rows="2"
                                  class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
                    </div>

                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Payment Terms</label>
                        <select name="payment_terms"
                                class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                            <option value="">-- Select --</option>
                            <!-- Add payment terms from master -->
                        </select>
                    </div>

                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Warranty</label>
                        <select name="warrenty"
                                class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                            <option value="">-- Select --</option>
                            <!-- Add warranty from master -->
                        </select>
                    </div>

                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Freight</label>
                        <select name="freight"
                                class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                            <option value="">-- Select --</option>
                            <!-- Add freight from master -->
                        </select>
                    </div>

                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Octroi</label>
                        <select name="octroi"
                                class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                            <option value="">-- Select --</option>
                            <!-- Add octroi from master -->
                        </select>
                    </div>

                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Mode of Dispatch</label>
                        <input type="text" name="mode_of_dispatch"
                               class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>

                    <div>
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Inspection</label>
                        <input type="text" name="inspection"
                               class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500">
                    </div>

                    <div class="col-span-2">
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Ship To</label>
                        <textarea name="ship_to" rows="2"
                                  class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
                    </div>

                    <div class="col-span-2">
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Remarks</label>
                        <textarea name="remarks" rows="2"
                                  class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
                    </div>

                    <div class="col-span-2">
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Insurance</label>
                        <textarea name="insurance" rows="2"
                                  class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
                    </div>

                    <div class="col-span-2">
                        <label class="block text-[11px] font-medium text-gray-700 mb-1">Terms & Conditions (TC)</label>
                        <textarea name="tc" rows="3"
                                  class="w-full px-2 py-1 border border-gray-300 rounded text-[11px] focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end gap-2 border-t border-gray-200 pt-4">
                <a href="{% if pr_spr_flag == 1 %}{% url 'material_management:po-spr-items' supplier.supplier_id %}{% else %}{% url 'material_management:po-pr-items' supplier.supplier_id %}{% endif %}"
                   class="px-4 py-2 border border-gray-300 rounded text-[11px] text-gray-700 hover:bg-gray-50 transition">
                    Cancel
                </a>
                <button type="submit"
                        class="px-6 py-2 bg-green-600 text-white rounded text-[11px] hover:bg-green-700 transition font-medium">
                    Create Purchase Order
                </button>
            </div>
        </form>

        <div class="p-3 bg-green-50 border-t border-green-200">
            <p class="text-[10px] text-green-800">
                <strong>Final Step:</strong> Review all items and enter the PO header details above. Click "Create Purchase Order" to finalize and save the PO to the database.
            </p>
        </div>
    </div>
</div>
{% endblock %}








