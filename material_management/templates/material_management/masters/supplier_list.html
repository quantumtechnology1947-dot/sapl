{% extends 'core/base.html' %}
{% load static %}

{% block title %}Supplier - Edit{% endblock %}

{% block content %}
<div class="max-w-full mx-auto px-4 py-2">
    <div class="w-full">
        <!-- Messages -->
        {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
            <div class="bg-{{ message.tags }}-100 border border-{{ message.tags }}-400 text-{{ message.tags }}-700 px-4 py-3 rounded mb-2" role="alert">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="bg-white rounded shadow border border-gray-300">
            <!-- Header -->
            <div class="bg-gradient-to-r from-gray-700 to-gray-600 px-4 py-2 rounded-t">
                <h2 class="text-white font-bold text-base">&nbsp;Supplier - Edit</h2>
            </div>

            <!-- Search Bar + New Button -->
            <div class="px-4 py-3 border-b border-gray-200 flex justify-between items-center gap-4">
                <form method="get" class="flex items-center gap-2 flex-1">
                    <label for="search" class="text-sm font-medium text-gray-700 whitespace-nowrap">Supplier Name</label>
                    <input type="text"
                           id="search"
                           name="search"
                           value="{{ search_query }}"
                           placeholder="Search by name or code..."
                           class="flex-1 px-3 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500" />
                    <button type="submit"
                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-1.5 rounded text-sm font-semibold transition">
                        Search
                    </button>
                </form>
                <a href="{% url 'material_management:supplier-create' %}"
                   class="bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded text-sm font-semibold transition whitespace-nowrap">
                    + New Supplier
                </a>
            </div>

            <!-- Table - Matching ASP.NET GridView exactly -->
            <div class="overflow-x-auto">
                <table class="w-full border-collapse table-auto">
                    <thead>
                        <tr class="bg-gray-50 border-b border-gray-300">
                            <th class="border-r border-gray-300 px-3 py-2 text-right text-xs font-semibold text-gray-700 whitespace-nowrap w-auto">SN</th>
                            <th class="border-r border-gray-300 px-3 py-2 text-center text-xs font-semibold text-gray-700 whitespace-nowrap w-auto">Fin Yrs</th>
                            <th class="border-r border-gray-300 px-3 py-2 text-left text-xs font-semibold text-gray-700 w-auto min-w-[200px]">Supplier Name</th>
                            <th class="border-r border-gray-300 px-3 py-2 text-center text-xs font-semibold text-gray-700 whitespace-nowrap w-auto">Code</th>
                            <th class="border-r border-gray-300 px-3 py-2 text-center text-xs font-semibold text-gray-700 whitespace-nowrap w-auto">Gen. Date</th>
                            <th class="px-3 py-2 text-left text-xs font-semibold text-gray-700 w-auto min-w-[150px]">Gen. By</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for supplier in suppliers %}
                        <tr class="hover:bg-gray-50 transition-colors duration-150">
                            <td class="border-r border-gray-200 px-3 py-2 text-right text-xs text-gray-700 whitespace-nowrap">
                                {{ forloop.counter|add:page_obj.start_index|add:"-1" }}
                            </td>
                            <td class="border-r border-gray-200 px-3 py-2 text-center text-xs text-gray-700 whitespace-nowrap">
                                {{ supplier.fin_year_display|default:"-" }}
                            </td>
                            <td class="border-r border-gray-200 px-3 py-2 text-left text-xs text-blue-600 hover:text-blue-800">
                                <a href="{% url 'material_management:supplier-detail' supplier.supplier_id %}"
                                   class="underline hover:no-underline">
                                    {{ supplier.supplier_name|truncatewords:10 }}
                                </a>
                            </td>
                            <td class="border-r border-gray-200 px-3 py-2 text-center text-xs text-gray-700 whitespace-nowrap">
                                {{ supplier.supplier_id }}
                            </td>
                            <td class="border-r border-gray-200 px-3 py-2 text-center text-xs text-gray-700 whitespace-nowrap">
                                {{ supplier.sys_date|date:"d-m-Y"|default:"-" }}
                            </td>
                            <td class="px-3 py-2 text-left text-xs text-gray-700">
                                {{ supplier.session_id|default:"-" }}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="px-6 py-16 text-center">
                                <div class="flex flex-col items-center justify-center">
                                    <p class="text-base font-semibold text-gray-700">No data to display !</p>
                                    {% if search_query %}
                                    <p class="text-sm text-gray-500 mt-2">Try adjusting your search query.</p>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination - Matching ASP.NET style -->
            {% if is_paginated %}
            <div class="px-4 py-3 border-t border-gray-200 flex justify-center items-center gap-1">
                {% if page_obj.has_previous %}
                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}"
                       class="px-2 py-1 text-xs text-blue-600 hover:text-blue-800 hover:underline">1</a>
                    {% if page_obj.number > 3 %}
                        <span class="px-1 text-xs text-gray-500">...</span>
                    {% endif %}
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                        {% if num == page_obj.number %}
                            <span class="px-2 py-1 text-xs font-bold text-gray-900">{{ num }}</span>
                        {% else %}
                            <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}"
                               class="px-2 py-1 text-xs text-blue-600 hover:text-blue-800 hover:underline">{{ num }}</a>
                        {% endif %}
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    {% if page_obj.number < paginator.num_pages|add:"-2" %}
                        <span class="px-1 text-xs text-gray-500">...</span>
                    {% endif %}
                    <a href="?page={{ paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}"
                       class="px-2 py-1 text-xs text-blue-600 hover:text-blue-800 hover:underline">{{ paginator.num_pages }}</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Ensure single-line rows with proper text wrapping */
table {
    border-collapse: collapse;
    width: 100%;
}
tbody tr {
    height: auto;
}
tbody td {
    vertical-align: middle;
    line-height: 1.4;
}
/* Text truncation for long supplier names */
tbody td:nth-child(3) {
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
}
</style>
{% endblock %}








