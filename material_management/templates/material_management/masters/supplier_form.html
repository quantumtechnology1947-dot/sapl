{% extends 'core/base.html' %}
{% load static %}

{% block title %}Supplier Master - {% if object %}Edit{% else %}New{% endif %}{% endblock %}

{% block page_title %}Supplier Master - {% if object %}Edit{% else %}New{% endif %}{% endblock %}

{% block content %}
<div class="max-w-full mx-auto px-2 py-4">
    <form method="post" class="bg-white rounded shadow border border-gray-300 text-xs" novalidate>
        {% csrf_token %}

        <!-- Header -->
        <div class="bg-gradient-to-r from-gray-700 to-gray-600 px-3 py-2">
            <h2 class="text-white font-bold text-sm">&nbsp;<strong>Supplier Master - {% if object %}Edit{% else %}New{% endif %}</strong></h2>
        </div>

        <div class="p-3 space-y-2">
            <!-- Row 1: Supplier Name + Submit -->
            <div class="grid grid-cols-12 gap-2 items-center">
                <label class="col-span-2 text-xs font-medium">Supplier's Name</label>
                <div class="col-span-7">
                    <input type="text" name="supplier_name" required class="w-full px-2 py-1 border border-gray-300 rounded text-xs" value="{{ object.supplier_name|default:'' }}">
                    <span class="text-red-600">*</span>
                </div>
                <div class="col-span-3 text-right">
                    <button type="submit" onclick="return confirm('Add this supplier?')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-1 rounded text-xs font-semibold">Submit</button>
                </div>
            </div>

            <!-- Row 2: Scope of Supply -->
            <div class="grid grid-cols-12 gap-2" id="scope-of-supply-section">
                <label class="col-span-2 text-xs font-medium">Scope of Supply</label>
                <div class="col-span-7">
                    <textarea id="scope_of_supply" name="scope_of_supply" rows="2" required class="w-full px-2 py-1 border border-gray-300 rounded text-xs">{{ object.scope_of_supply|default:'' }}</textarea>
                    <span class="text-red-600">*</span>
                </div>
            </div>

            <!-- Address Section Header -->
            <div class="grid grid-cols-12 gap-2 bg-gray-100 py-1 mt-3">
                <div class="col-span-2 text-center text-xs font-bold">Address/Details</div>
                <div class="col-span-3 text-center text-xs font-bold bg-gray-200 rounded px-1">REGD. OFFICE</div>
                <div class="col-span-3 text-center text-xs font-bold bg-gray-200 rounded px-1">WORKS/FACTORY</div>
                <div class="col-span-4 text-center text-xs font-bold bg-gray-200 rounded px-1">MATERIAL DELIVERY</div>
            </div>

            <!-- Address -->
            <div class="grid grid-cols-12 gap-2">
                <label class="col-span-2 text-xs">Address</label>
                <div class="col-span-3"><textarea name="regd_address" rows="2" required class="w-full px-2 py-1 border rounded text-xs">{{ object.regd_address|default:'' }}</textarea><span class="text-red-600">*</span></div>
                <div class="col-span-3"><textarea name="work_address" rows="2" required class="w-full px-2 py-1 border rounded text-xs">{{ object.work_address|default:'' }}</textarea><span class="text-red-600">*</span></div>
                <div class="col-span-4"><textarea name="material_del_address" rows="2" required class="w-full px-2 py-1 border rounded text-xs">{{ object.material_del_address|default:'' }}</textarea><span class="text-red-600">*</span></div>
            </div>

            <!-- Country Row -->
            <div class="grid grid-cols-12 gap-2">
                <label class="col-span-2 text-xs">Country</label>
                <div class="col-span-3">
                    <select name="regd_country" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for country in countries %}
                        <option value="{{ country.cid }}" {% if object and object.regd_country|stringformat:"s" == country.cid|stringformat:"s" %}selected{% endif %}>{{ country.countryname }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
                <div class="col-span-3">
                    <select name="work_country" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for country in countries %}
                        <option value="{{ country.cid }}" {% if object and object.work_country|stringformat:"s" == country.cid|stringformat:"s" %}selected{% endif %}>{{ country.countryname }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
                <div class="col-span-4">
                    <select name="material_del_country" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for country in countries %}
                        <option value="{{ country.cid }}" {% if object and object.material_del_country|stringformat:"s" == country.cid|stringformat:"s" %}selected{% endif %}>{{ country.countryname }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
            </div>

            <!-- State Row -->
            <div class="grid grid-cols-12 gap-2">
                <label class="col-span-2 text-xs">State</label>
                <div class="col-span-3">
                    <select name="regd_state" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for state in states %}
                        <option value="{{ state.sid }}" {% if object and object.regd_state|stringformat:"s" == state.sid|stringformat:"s" %}selected{% endif %}>{{ state.statename }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
                <div class="col-span-3">
                    <select name="work_state" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for state in states %}
                        <option value="{{ state.sid }}" {% if object and object.work_state|stringformat:"s" == state.sid|stringformat:"s" %}selected{% endif %}>{{ state.statename }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
                <div class="col-span-4">
                    <select name="material_del_state" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for state in states %}
                        <option value="{{ state.sid }}" {% if object and object.material_del_state|stringformat:"s" == state.sid|stringformat:"s" %}selected{% endif %}>{{ state.statename }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
            </div>

            <!-- City Row -->
            <div class="grid grid-cols-12 gap-2">
                <label class="col-span-2 text-xs">City</label>
                <div class="col-span-3">
                    <select name="regd_city" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for city in cities %}
                        <option value="{{ city.cityid }}" {% if object and object.regd_city|stringformat:"s" == city.cityid|stringformat:"s" %}selected{% endif %}>{{ city.cityname }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
                <div class="col-span-3">
                    <select name="work_city" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for city in cities %}
                        <option value="{{ city.cityid }}" {% if object and object.work_city|stringformat:"s" == city.cityid|stringformat:"s" %}selected{% endif %}>{{ city.cityname }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
                <div class="col-span-4">
                    <select name="material_del_city" required class="w-full px-2 py-1 border rounded text-xs">
                        <option value="">Select</option>
                        {% for city in cities %}
                        <option value="{{ city.cityid }}" {% if object and object.material_del_city|stringformat:"s" == city.cityid|stringformat:"s" %}selected{% endif %}>{{ city.cityname }}</option>
                        {% endfor %}
                    </select>
                    <span class="text-red-600">*</span>
                </div>
            </div>

            <!-- PIN No. Row -->
            <div class="grid grid-cols-12 gap-2">
                <label class="col-span-2 text-xs">PIN No.</label>
                <div class="col-span-3"><input type="text" name="regd_pin_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.regd_pin_no|default:'' }}"><span class="text-red-600">*</span></div>
                <div class="col-span-3"><input type="text" name="work_pin_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.work_pin_no|default:'' }}"><span class="text-red-600">*</span></div>
                <div class="col-span-4"><input type="text" name="material_del_pin_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.material_del_pin_no|default:'' }}"><span class="text-red-600">*</span></div>
            </div>

            <div class="grid grid-cols-12 gap-2">
                <label class="col-span-2 text-xs">Contact No.</label>
                <div class="col-span-3"><input type="text" name="regd_contact_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.regd_contact_no|default:'' }}"><span class="text-red-600">*</span></div>
                <div class="col-span-3"><input type="text" name="work_contact_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.work_contact_no|default:'' }}"><span class="text-red-600">*</span></div>
                <div class="col-span-4"><input type="text" name="material_del_contact_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.material_del_contact_no|default:'' }}"><span class="text-red-600">*</span></div>
            </div>

            <!-- Contact Details Grid -->
            <div class="grid grid-cols-6 gap-2 mt-3">
                <label class="text-xs">Contact person</label>
                <div><input type="text" name="contact_person" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.contact_person|default:'' }}"><span class="text-red-600">*</span></div>
                <label class="text-xs">E-mail</label>
                <div><input type="email" name="email" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.email|default:'' }}"><span class="text-red-600">*</span></div>
                <label class="text-xs">Contact No.</label>
                <div><input type="text" name="contact_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.contact_no|default:'' }}"><span class="text-red-600">*</span></div>
            </div>

            <div class="grid grid-cols-6 gap-2">
                <label class="text-xs">GST No.</label>
                <div><input type="text" name="tin_vat_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.tin_vat_no|default:'' }}"><span class="text-red-600">*</span></div>
                <div class="col-span-4"></div>
            </div>

            <!-- Radio Buttons -->
            <div class="grid grid-cols-6 gap-2">
                <label class="text-xs">Mod GST Applicable</label>
                <div class="flex gap-3"><label class="flex items-center text-xs"><input type="radio" name="mod_vat_applicable" value="1" {% if object and object.mod_vat_applicable == 1 %}checked{% endif %}><span class="ml-1">Yes</span></label><label class="flex items-center text-xs"><input type="radio" name="mod_vat_applicable" value="0" {% if not object or object.mod_vat_applicable == 0 %}checked{% endif %}><span class="ml-1">No</span></label></div>
                <label class="text-xs">Mod GST Invoice</label>
                <div class="flex gap-3"><label class="flex items-center text-xs"><input type="radio" name="mod_vat_invoice" value="1" {% if object and object.mod_vat_invoice == 1 %}checked{% endif %}><span class="ml-1">Yes</span></label><label class="flex items-center text-xs"><input type="radio" name="mod_vat_invoice" value="0" {% if not object or object.mod_vat_invoice == 0 %}checked{% endif %}><span class="ml-1">No</span></label></div>
            </div>

            <!-- Bank Details -->
            <div class="grid grid-cols-6 gap-2">
                <label class="text-xs">Bank Acc No</label>
                <div><input type="text" name="bank_acc_no" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.bank_acc_no|default:'' }}"><span class="text-red-600">*</span></div>
                <label class="text-xs">Bank Name</label>
                <div><input type="text" name="bank_name" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.bank_name|default:'' }}"><span class="text-red-600">*</span></div>
                <label class="text-xs">Bank Branch</label>
                <div><input type="text" name="bank_branch" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.bank_branch|default:'' }}"><span class="text-red-600">*</span></div>
            </div>

            <div class="grid grid-cols-6 gap-2">
                <label class="text-xs">Bank Address</label>
                <div><textarea name="bank_address" rows="2" required class="w-full px-2 py-1 border rounded text-xs">{{ object.bank_address|default:'' }}</textarea><span class="text-red-600">*</span></div>
                <label class="text-xs">Bank Acc Type</label>
                <div><input type="text" name="bank_acc_type" required class="w-full px-2 py-1 border rounded text-xs" value="{{ object.bank_acc_type|default:'' }}"><span class="text-red-600">*</span></div>
                <label class="text-xs">Service Coverage</label>
                <div><select name="service_coverage" class="w-full px-2 py-1 border rounded text-xs">{% for sc in service_coverages %}<option value="{{ sc.coverage }}" {% if object and object.service_coverage == sc.coverage %}selected{% endif %}>{{ sc.coverage }}</option>{% endfor %}</select></div>
            </div>

            <div class="grid grid-cols-6 gap-2">
                <label class="text-xs">P & F</label>
                <div><select name="pf" class="w-full px-2 py-1 border rounded text-xs"><option>NA</option></select></div>
                <label class="text-xs">CGST/IGST</label>
                <div><select name="ex_st" class="w-full px-2 py-1 border rounded text-xs"><option>NA</option></select></div>
                <label class="text-xs">SGST</label>
                <div><select name="vat" class="w-full px-2 py-1 border rounded text-xs"><option>NA</option></select></div>
            </div>

            <!-- Business Nature & Type -->
            <div class="grid grid-cols-2 gap-3 mt-3">
                <div>
                    <label class="text-xs font-medium block mb-1">Business Nature</label>
                    <div class="border rounded p-2 h-24 overflow-y-auto bg-gray-50">
                        {% for nature in business_natures %}<label class="flex items-center mb-1 text-xs"><input type="checkbox" name="business_nature" value="{{ nature.nature }}" class="mr-2" {% if object and nature.nature in object.business_nature %}checked{% endif %}>{{ nature.nature }}</label>{% endfor %}
                    </div>
                </div>
                <div>
                    <label class="text-xs font-medium block mb-1">Business Type</label>
                    <div class="border rounded p-2 h-24 overflow-y-auto bg-gray-50">
                        {% for type in business_types %}<label class="flex items-center mb-1 text-xs"><input type="checkbox" name="business_type" value="{{ type.type }}" class="mr-2" {% if object and type.type in object.business_type %}checked{% endif %}>{{ type.type }}</label>{% endfor %}
                    </div>
                </div>
            </div>

            <!-- Remarks -->
            <div class="grid grid-cols-12 gap-2 mt-2">
                <label class="col-span-2 text-xs">Remarks</label>
                <div class="col-span-7"><textarea name="remark" rows="3" required class="w-full px-2 py-1 border rounded text-xs">{{ object.remark|default:'' }}</textarea><span class="text-red-600">*</span></div>
            </div>

            <!-- Hidden fields -->
            <input type="hidden" name="regd_fax_no" value="-">
            <input type="hidden" name="work_fax_no" value="-">
            <input type="hidden" name="material_del_fax_no" value="-">

            <!-- Hidden fields for optional tax/business fields (ASP.NET sets these to "-" or default IDs) -->
            <input type="hidden" name="pan_no" value="-">
            <input type="hidden" name="tin_cst_no" value="-">
            <input type="hidden" name="ecc_no" value="-">
            <input type="hidden" name="juridiction_code" value="-">
            <input type="hidden" name="commissionurate" value="-">
            <input type="hidden" name="divn" value="-">
            <input type="hidden" name="range" value="-">
            <input type="hidden" name="tds_code" value="-">

            <!-- Hidden dropdowns (P&F, CGST/IGST, SGST) - default to first option (ID=1) -->
            <input type="hidden" name="pf" value="1">
            <input type="hidden" name="ex_st" value="1">
            <input type="hidden" name="vat" value="1">

            <!-- Hidden radio buttons (Mod GST) - default to "No" (0) -->
            <input type="hidden" name="mod_vat_applicable" value="0">
            <input type="hidden" name="mod_vat_invoice" value="0">
        </div>
    </form>
</div>

<script>
// Auto-focus and highlight Scope of Supply field when coming from Scope of Supplier page
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('focus') === 'scope') {
        const scopeField = document.getElementById('scope_of_supply');
        const scopeSection = document.getElementById('scope-of-supply-section');

        if (scopeField && scopeSection) {
            // Scroll to the field
            scopeSection.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Focus the field after scroll
            setTimeout(function() {
                scopeField.focus();
                scopeField.select();

                // Add temporary highlight animation
                scopeSection.style.backgroundColor = '#fef3c7'; // yellow-100
                scopeSection.style.transition = 'background-color 2s ease';

                setTimeout(function() {
                    scopeSection.style.backgroundColor = '';
                }, 2000);
            }, 500);
        }
    }
});
</script>
{% endblock %}








