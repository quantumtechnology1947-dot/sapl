{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="max-w-full mx-auto px-4 py-2">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-base font-bold text-gray-800">{{ page_title }}</h1>
        <a href="{% url 'sys_admin:financial_year_create' %}"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200">
            <i class="fas fa-plus mr-2"></i>Create Financial Year
        </a>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded border border-gray-200 p-4 mb-6">
        <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Company Filter -->
            <div>
                <label for="company" class="block text-sm font-medium text-gray-700 mb-2">Filter by Company</label>
                <select name="company" id="company"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    hx-get="{% url 'sys_admin:financial_year_list' %}" hx-target="#financial-year-table"
                    hx-trigger="change" hx-include="[name='status']">
                    <option value="">All Companies</option>
                    {% for company in companies %}
                    <option value="{{ company.compid }}" {% if selected_company == company.compid|stringformat:"s" %}selected{% endif %}>
                        {{ company.companyname }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Status Filter -->
            <div>
                <label for="status" class="block text-sm font-medium text-gray-700 mb-2">Filter by Status</label>
                <select name="status" id="status"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    hx-get="{% url 'sys_admin:financial_year_list' %}" hx-target="#financial-year-table"
                    hx-trigger="change" hx-include="[name='company']">
                    <option value="">All Status</option>
                    <option value="open" {% if selected_status == 'open' %}selected{% endif %}>Open</option>
                    <option value="closed" {% if selected_status == 'closed' %}selected{% endif %}>Closed</option>
                </select>
            </div>

            <!-- Clear Filters -->
            <div class="flex items-end">
                <a href="{% url 'sys_admin:financial_year_list' %}"
                    class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-center transition duration-200">
                    Clear Filters
                </a>
            </div>
        </form>
    </div>

    <!-- Financial Year Table -->
    <div id="financial-year-table" class="bg-white rounded border border-gray-200 overflow-hidden">
        {% if financial_years %}
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Financial Year
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Company
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        From Date
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        To Date
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Status
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for year in financial_years %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">{{ year.finyear }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">
                            {% with company=year.get_company %}
                            {{ company.companyname|default:"N/A" }}
                            {% endwith %}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ year.finyearfrom }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ year.finyearto }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% if year.is_closed %}
                        <span
                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                            Closed
                        </span>
                        {% else %}
                        <span
                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            Open
                        </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="{% url 'sys_admin:financial_year_details' year.finyearid %}"
                            class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-eye"></i> View
                        </a>
                        {% if not year.is_closed %}
                        <a href="{% url 'sys_admin:financial_year_edit' year.finyearid %}"
                            class="text-indigo-600 hover:text-indigo-900 mr-3">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a href="{% url 'sys_admin:financial_year_delete' year.finyearid %}"
                            class="text-red-600 hover:text-red-900"
                            onclick="return confirm('Are you sure you want to delete this financial year?');">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination Component -->
        {% include 'core/components/pagination.html' with page_obj=page_obj %}
        {% else %}
        {% include 'core/components/empty_state.html' with
            title="No financial years found"
            message="Get started by creating your first financial year."
            action_url='sys_admin:financial_year_create'
            action_text="Create First Financial Year"
        %}
        {% endif %}
    </div>
</div>
{% endblock %}








